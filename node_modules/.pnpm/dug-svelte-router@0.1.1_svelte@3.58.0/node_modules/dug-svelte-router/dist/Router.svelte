<script>
// @ts-nocheck

    export let routes = []
    let actives = routes.map(x => false)
    let loads = routes.map(x => false)
    let currentHash = window.location.hash

    export let mountAll = false
    export let destroyAll = false

    scanRoutes()

    window.addEventListener('hashchange', ()=>{
        currentHash = window.location.hash
        scanRoutes()
    })
    
    function scanRoutes() {
        routes.forEach((route, index) => {
            actives[index] = 
                route.hash ? 
                    route.hash.startsWith('layout:') ?
                        currentHash.startsWith(route.hash.split(':')[1]) :
                        currentHash === route.hash
                        :
                    currentHash === '' || currentHash === '#'
            
            if (actives[index]) loads[index] = true
        })
        routes = routes
    }
</script>

{#each routes as route, index}
{@const mount = mountAll || route.mount}
{@const destroy = destroyAll || route.destroy}
{@const [active, loaded] = [actives[index], loads[index]]}

{#if mount && destroy}
    {#if !loaded || active && loaded}
        <span class="__dug-route-wrapper" style="display: {active ? 'inline' : 'none'};">
            <svelte:component this={route.component} />
        </span>
    {/if}
{:else if mount && !destroy}
    <span class="__dug-route-wrapper" style="display: {active ? 'inline' : 'none'};">
        <svelte:component this={route.component} />
    </span>
{:else if !mount && destroy}
    {#if loaded && active}
        <svelte:component this={route.component} />
    {/if}
{:else if !mount && !destroy}
    {#if loaded}
        <span class="__dug-route-wrapper" style="display: {active ? 'inline' : 'none'};">
            <svelte:component this={route.component} />
        </span>
    {/if}
{/if}

{/each}